name: CI

on:
  - push
  - pull_request

permissions:
  contents: read

jobs:
  crystal:
    name: CI - Crystal
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: solutions/crystal
    steps:
      - uses: actions/checkout@v4
      - name: Set up Crystal
        uses: crystal-lang/install-crystal@v1
      - name: Run tests
        run: find . -name '*_spec.cr' -exec crystal spec --order=random {} +
      - name: Run solutions
        run : find . -name main.cr -print0 | sort -z | xargs -0 -i crystal run {}
      - name: Check formatting
        run: |
          crystal tool format
          git diff --exit-code
  ruby:
    name: CI - Ruby
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: solutions/ruby
    steps:
      - uses: actions/checkout@v4
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          working-directory: solutions/ruby
          bundler-cache: true
      - name: Run tests
        run: bundle exec rake test
      - name: Run solutions
        run : find . -name main.rb -print0 | sort -z | xargs -0 -i ruby {}
      - name: Check linting and formatting
        run: bundle exec rake rubocop
